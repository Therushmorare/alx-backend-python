#!/bin/bash
# Blue-Green Deployment Script for Django app

set -e

echo ">>> Deploying Blue version..."
kubectl apply -f blue_deployment.yaml

echo ">>> Deploying Green version..."
kubectl apply -f green_deployment.yaml

echo ">>> Applying Service..."
kubectl apply -f kubeservice.yaml

echo ">>> Checking logs for Blue pods..."
kubectl get pods -l app=django,version=blue
for pod in $(kubectl get pods -l app=django,version=blue -o name); do
  echo "Logs for $pod:"
  kubectl logs $pod --tail=10
done

echo ">>> Checking logs for Green pods..."
kubectl get pods -l app=django,version=green
for pod in $(kubectl get pods -l app=django,version=green -o name); do
  echo "Logs for $pod:"
  kubectl logs $pod --tail=10
done

echo ">>> Blue-Green Deployment applied successfully!"
echo "You can switch traffic in kubeservice.yaml from version=blue to version=green."

